<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to drop and delete metrics in Prometheus | Tanmay Bhat</title>
<meta name=keywords content="Prometheus"><meta name=description content="Keeping your Prometheus optimized can be a tedious task over time, but it&rsquo;s essential in order to maintain the stability of it and also to keep the cardinality under control.
Identifying the unnecessary metrics at source, deleting the existing unneeded metrics from your TSDB regularly will keep your Prometheus storage & performance intact.
In this article we’ll look at both identifying, dropping them at source and deleting the already stored metrics from Prometheus."><meta name=author content="Tanmay Bhat"><link rel=canonical href=https://tanmay-bhat.github.io/posts/how-to-drop-and-delete-metrics-in-prometheus/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://tanmay-bhat.github.io/memoji.png><link rel=icon type=image/png sizes=16x16 href=https://tanmay-bhat.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tanmay-bhat.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tanmay-bhat.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tanmay-bhat.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tanmay-bhat.github.io/posts/how-to-drop-and-delete-metrics-in-prometheus/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PXF78BGMY"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PXF78BGMY")}</script><meta property="og:url" content="https://tanmay-bhat.github.io/posts/how-to-drop-and-delete-metrics-in-prometheus/"><meta property="og:site_name" content="Tanmay Bhat"><meta property="og:title" content="How to drop and delete metrics in Prometheus"><meta property="og:description" content="Keeping your Prometheus optimized can be a tedious task over time, but it’s essential in order to maintain the stability of it and also to keep the cardinality under control.
Identifying the unnecessary metrics at source, deleting the existing unneeded metrics from your TSDB regularly will keep your Prometheus storage & performance intact.
In this article we’ll look at both identifying, dropping them at source and deleting the already stored metrics from Prometheus."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-01T00:00:00+00:00"><meta property="article:tag" content="Prometheus"><meta property="og:image" content="https://tanmay-bhat.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tanmay-bhat.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="How to drop and delete metrics in Prometheus"><meta name=twitter:description content="Keeping your Prometheus optimized can be a tedious task over time, but it&rsquo;s essential in order to maintain the stability of it and also to keep the cardinality under control.
Identifying the unnecessary metrics at source, deleting the existing unneeded metrics from your TSDB regularly will keep your Prometheus storage & performance intact.
In this article we’ll look at both identifying, dropping them at source and deleting the already stored metrics from Prometheus."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tanmay-bhat.github.io/posts/"},{"@type":"ListItem","position":2,"name":"How to drop and delete metrics in Prometheus","item":"https://tanmay-bhat.github.io/posts/how-to-drop-and-delete-metrics-in-prometheus/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to drop and delete metrics in Prometheus","name":"How to drop and delete metrics in Prometheus","description":"Keeping your Prometheus optimized can be a tedious task over time, but it\u0026rsquo;s essential in order to maintain the stability of it and also to keep the cardinality under control.\nIdentifying the unnecessary metrics at source, deleting the existing unneeded metrics from your TSDB regularly will keep your Prometheus storage \u0026amp; performance intact.\nIn this article we’ll look at both identifying, dropping them at source and deleting the already stored metrics from Prometheus.\n","keywords":["Prometheus"],"articleBody":"Keeping your Prometheus optimized can be a tedious task over time, but it’s essential in order to maintain the stability of it and also to keep the cardinality under control.\nIdentifying the unnecessary metrics at source, deleting the existing unneeded metrics from your TSDB regularly will keep your Prometheus storage \u0026 performance intact.\nIn this article we’ll look at both identifying, dropping them at source and deleting the already stored metrics from Prometheus.\nIdentifying the costly metrics : There are 3 ways in which you can get the top 10 costly metrics which are consuming your TSDB :\nVia promtool: Promtool is bundled with Prometheus, if you’re running Prometheus in Kubernetes, then you can just exec into the pod and run the below command. If you’re running Prometheus in VMs, the Promtool binary will be in the same directory as Prometheus. Command : promtool tsdb analyze path-to-data-directory/.\n/prometheus $ promtool tsdb analyze /data/ Block ID: 01FYV026P5AYM47XSSFT4WVG6X Duration: 1h59m59.999s Series: 173756 Label names: 321 Postings (unique label pairs): 18485 Postings entries (total label pairs): 3000877 Label pairs most involved in churning: 32894 namespace=default 14131 job=kubernetes-nodes-cadvisor 13606 job=kubernetes-service-endpoints Label names most involved in churning: 35344 __name__ 35022 instance 35022 job 34345 namespace 28503 pod 15626 container Most common label pairs: 82253 namespace=default 54338 job=linkerd-proxy 54338 control_plane_ns=linkerd 52074 job=kubernetes-service-endpoints 51637 app_kubernetes_io_managed_by=Helm 41292 kubernetes_io_os=linux Label names with highest cumulative label value length: 187875 id 116231 name 83663 __name__ 67642 path 67233 container_id 41271 image 31047 image_id 25053 filename 23436 uid 21800 pod Highest cardinality labels: 2227 __name__ 1846 id 1369 name 921 container_id 844 replicaset 733 owner_name Highest cardinality metric names: 20280 response_latency_ms_bucket 10140 route_response_latency_ms_bucket 5076 etcd_request_duration_seconds_bucket 3380 control_response_latency_ms_bucket 2079 stack_poll_total 1893 container_memory_usage_bytes 1893 container_memory_working_set_bytes 1893 container_cpu_user_seconds_total 1893 container_memory_max_usage_bytes 1893 container_memory_rss 1893 container_cpu_system_seconds_total 1745 tcp_open_total 1745 tcp_read_bytes_total 1745 tcp_open_connections 1745 tcp_write_bytes_total 1700 container_cpu_usage_seconds_total 1474 rest_client_request_latency_seconds_bucket 1424 route_request_total 1295 kube_pod_container_resource_requests 1260 http_client_request_latency_seconds_bucket Via /tsdb-status endpoint: Prometheus already provides outputs of the above tsdb analyze command in easy to understand manner at prometheus-example.com/tsdb-status endpoint.\nThere are more details about the label pairs etc. on that endpoint, but for the scope of this article, we’ll focus on the top 10 series count by metric name. Via PromQL query: If you’re more fond of PromQL to get things done, the above result can also be achieved by running the PromQL query : topk(10, count by (__name__)({__name__=~\".+\"})) From the above pointers, now we know what are our costly metrics which we need to be aware of. Let’s assume we decided that we want to drop prometheus_http_request_duration_seconds_bucket \u0026 prometheus_http_response_size_bytes_bucket metric, as it’s of no practical use to us.\n1. Drop In order to drop the above-mentioned metrics, we need to add metric_relabel_configs in Prometheus scrape config with the metric name we need to drop :\nscrape_configs: - job_name: \"prometheus\" scrape_interval: 15s static_configs: - targets: [\"localhost:9090\"] metric_relabel_configs: - source_labels: [__name__] regex: '(prometheus_http_request_duration_seconds_bucket|prometheus_http_response_size_bytes_bucket)' action: drop complete flow will be like :\nmetric_relabel_configs : metric relabeling process starts once the metrics is scraped. The reason for that is, the main label __name__ will be generated post scraping.\nsource_labels: we’re utilizing the label __name__ to get the desired metric, since this itself is a label which has value of metric name. i.e __name__=prometheus_http_request_duration_seconds_bucket\nIf you have lots of metrics which you need to drop, a better approach would be to use the action “keep” and mention the metric names you need to keep and everything else will be dropped.\n2. Keep As mentioned above, let’s try the permissive approach of Prometheus. Here we will be only keeping metric prometheus_http_requests_total and drop everything else. The config looks like this : scrape_configs: - job_name: \"prometheus\" scrape_interval: 5s static_configs: - targets: [\"localhost:9090\"] metric_relabel_configs: - source_labels: [__name__] regex: prometheus_http_requests_total action: keep Gotchas Once you have dropped the metric of choice, new samples won’t get stored for that metric. When a metric is not receiving any samples for ~5 min, it will be considered as a stale metric. You can read more about staleness here. Depending on your retention period, the old time series will be removed once it reaches the retention, by default it’s 15 days. However, if you want to delete the stored metrics to clear up space, you can follow the below steps to achieve that. Deletion of single metric: In order to delete a series based on label, first you need to enable Admin API. You can enable the flag -web.enable-admin-api to do that. The complete command will look like this : ./prometheus --web.enable-admin-api Send a POST request with the label selectors of your choice to delete the resulting time series from starting date till today, i.e, everything for that time series. For example, the below will delete prometheus_http_requests_total from all scrape job (if there were multiple).\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=prometheus_http_requests_total' In case you need to delete a metric from a specific scrape job, you can mention the job label.\n-g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=prometheus_http_requests_total{job=\"prometheus\"}' The above step will mark the time series for deletion, but won’t remove them from the disk at that moment. They will get flushed in future compaction. If you need to remove them from the disk to clear the space instantly, you can hit the tombstone endpoint to purge the time series from the disk : curl -XPOST http://localhost:9090/api/v1/admin/tsdb/clean_tombstones Deletion of multiple metrics: If you’re cleaning / optimizing your Prometheus TSDB, deleting a single metric won’t do anything. Hence, deletion of 100s if not 1000s of unnecessary time series is evident. At of the time writing this article, you can’t delete n metrics which are matched by regular expression. I found a workaround for that via shell scripting for multiple metric deletion at a single shot. Example : There are around 66 go based metrics which are available at Prometheus /metrics endpoint.\nIf you want to delete all of them, then you can perform the below steps, since regex based deletion is not possible as of now. The below command will grab all the metrics which starts with go_ . # get all metric name with go_* into a txt file. curl http://localhost:9090/api/v1/label/__name__/values | tr ',' '\\n' | tr -d '\"' | grep '^go_.*' \u003e prom_go_metrics.txt The metrics collected in file will look like : cat prom_go_metrics.txt | head -n 5 go_gc_cycles_forced_gc_cycles_total go_gc_cycles_total_gc_cycles_total go_gc_duration_seconds go_gc_duration_seconds_count go_gc_duration_seconds_sum Create a bash script delete-metrics.sh, append the below contents and run it : #shell script to go over each metric in the file and request the API for deletion recursively. #!/bin/bash for i in `cat prom_go_metrics.txt`; do curl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]='$i'' done If the deletion is successful, the response will be empty. Once the deletion is successful, use Promtool to query metrics via CLI or check via web UI to see if the metric returns any value. The response should be empty. promtool query series http://localhost:9090 --match=go_gc_heap_allocs_by_size_bytes_total References :\nhttps://prometheus.io/docs/prometheus/latest/querying/api/#delete-series https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs https://relabeler.promlabs.com/ ","wordCount":"1127","inLanguage":"en","image":"https://tanmay-bhat.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-04-01T00:00:00Z","dateModified":"2022-04-01T00:00:00Z","author":{"@type":"Person","name":"Tanmay Bhat"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanmay-bhat.github.io/posts/how-to-drop-and-delete-metrics-in-prometheus/"},"publisher":{"@type":"Organization","name":"Tanmay Bhat","logo":{"@type":"ImageObject","url":"https://tanmay-bhat.github.io/memoji.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tanmay-bhat.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tanmay-bhat.github.io/about/ title=About><span>About</span></a></li><li><a href=https://tanmay-bhat.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://tanmay-bhat.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tanmay-bhat.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tanmay-bhat.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How to drop and delete metrics in Prometheus</h1><div class=post-meta><span title='2022-04-01 00:00:00 +0000 UTC'>April 1, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Tanmay Bhat&nbsp;|&nbsp;<a href=https://github.com/tanmay-bhat/tanmay-bhat.github.io/blob/main/content/posts/How-to-drop-and-delete-metrics-in-Prometheus.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Keeping your Prometheus optimized can be a tedious task over time, but it&rsquo;s essential in order to maintain the stability of it and also to keep the cardinality under control.</p><p>Identifying the unnecessary metrics at source, deleting the existing unneeded metrics from your TSDB regularly will keep your Prometheus storage & performance intact.</p><p>In this article we’ll look at both identifying, dropping them at source and deleting the already stored metrics from Prometheus.</p><h2 id=identifying-the-costly-metrics->Identifying the costly metrics :<a hidden class=anchor aria-hidden=true href=#identifying-the-costly-metrics->#</a></h2><p>There are 3 ways in which you can get the top 10 costly metrics which are consuming your TSDB :</p><ol><li><strong>Via promtool:</strong></li></ol><ul><li>Promtool is bundled with Prometheus, if you’re running Prometheus in Kubernetes, then you can just exec into the pod and run the below command.</li><li>If you’re running Prometheus in VMs, the Promtool binary will be in the same directory as Prometheus.</li></ul><p>Command : <code>promtool tsdb analyze path-to-data-directory/</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/prometheus $ promtool tsdb analyze /data/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Block ID: 01FYV026P5AYM47XSSFT4WVG6X
</span></span><span style=display:flex><span>Duration: 1h59m59.999s
</span></span><span style=display:flex><span>Series: <span style=color:#ae81ff>173756</span>
</span></span><span style=display:flex><span>Label names: <span style=color:#ae81ff>321</span>
</span></span><span style=display:flex><span>Postings <span style=color:#f92672>(</span>unique label pairs<span style=color:#f92672>)</span>: <span style=color:#ae81ff>18485</span>
</span></span><span style=display:flex><span>Postings entries <span style=color:#f92672>(</span>total label pairs<span style=color:#f92672>)</span>: <span style=color:#ae81ff>3000877</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Label pairs most involved in churning:
</span></span><span style=display:flex><span><span style=color:#ae81ff>32894</span> namespace<span style=color:#f92672>=</span>default
</span></span><span style=display:flex><span><span style=color:#ae81ff>14131</span> job<span style=color:#f92672>=</span>kubernetes-nodes-cadvisor
</span></span><span style=display:flex><span><span style=color:#ae81ff>13606</span> job<span style=color:#f92672>=</span>kubernetes-service-endpoints
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Label names most involved in churning:
</span></span><span style=display:flex><span><span style=color:#ae81ff>35344</span> __name__
</span></span><span style=display:flex><span><span style=color:#ae81ff>35022</span> instance
</span></span><span style=display:flex><span><span style=color:#ae81ff>35022</span> job
</span></span><span style=display:flex><span><span style=color:#ae81ff>34345</span> namespace
</span></span><span style=display:flex><span><span style=color:#ae81ff>28503</span> pod
</span></span><span style=display:flex><span><span style=color:#ae81ff>15626</span> container
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Most common label pairs:
</span></span><span style=display:flex><span><span style=color:#ae81ff>82253</span> namespace<span style=color:#f92672>=</span>default
</span></span><span style=display:flex><span><span style=color:#ae81ff>54338</span> job<span style=color:#f92672>=</span>linkerd-proxy
</span></span><span style=display:flex><span><span style=color:#ae81ff>54338</span> control_plane_ns<span style=color:#f92672>=</span>linkerd
</span></span><span style=display:flex><span><span style=color:#ae81ff>52074</span> job<span style=color:#f92672>=</span>kubernetes-service-endpoints
</span></span><span style=display:flex><span><span style=color:#ae81ff>51637</span> app_kubernetes_io_managed_by<span style=color:#f92672>=</span>Helm
</span></span><span style=display:flex><span><span style=color:#ae81ff>41292</span> kubernetes_io_os<span style=color:#f92672>=</span>linux
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Label names with highest cumulative label value length:
</span></span><span style=display:flex><span><span style=color:#ae81ff>187875</span> id
</span></span><span style=display:flex><span><span style=color:#ae81ff>116231</span> name
</span></span><span style=display:flex><span><span style=color:#ae81ff>83663</span> __name__
</span></span><span style=display:flex><span><span style=color:#ae81ff>67642</span> path
</span></span><span style=display:flex><span><span style=color:#ae81ff>67233</span> container_id
</span></span><span style=display:flex><span><span style=color:#ae81ff>41271</span> image
</span></span><span style=display:flex><span><span style=color:#ae81ff>31047</span> image_id
</span></span><span style=display:flex><span><span style=color:#ae81ff>25053</span> filename
</span></span><span style=display:flex><span><span style=color:#ae81ff>23436</span> uid
</span></span><span style=display:flex><span><span style=color:#ae81ff>21800</span> pod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Highest cardinality labels:
</span></span><span style=display:flex><span><span style=color:#ae81ff>2227</span> __name__
</span></span><span style=display:flex><span><span style=color:#ae81ff>1846</span> id
</span></span><span style=display:flex><span><span style=color:#ae81ff>1369</span> name
</span></span><span style=display:flex><span><span style=color:#ae81ff>921</span> container_id
</span></span><span style=display:flex><span><span style=color:#ae81ff>844</span> replicaset
</span></span><span style=display:flex><span><span style=color:#ae81ff>733</span> owner_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Highest cardinality metric names:
</span></span><span style=display:flex><span><span style=color:#ae81ff>20280</span> response_latency_ms_bucket
</span></span><span style=display:flex><span><span style=color:#ae81ff>10140</span> route_response_latency_ms_bucket
</span></span><span style=display:flex><span><span style=color:#ae81ff>5076</span> etcd_request_duration_seconds_bucket
</span></span><span style=display:flex><span><span style=color:#ae81ff>3380</span> control_response_latency_ms_bucket
</span></span><span style=display:flex><span><span style=color:#ae81ff>2079</span> stack_poll_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1893</span> container_memory_usage_bytes
</span></span><span style=display:flex><span><span style=color:#ae81ff>1893</span> container_memory_working_set_bytes
</span></span><span style=display:flex><span><span style=color:#ae81ff>1893</span> container_cpu_user_seconds_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1893</span> container_memory_max_usage_bytes
</span></span><span style=display:flex><span><span style=color:#ae81ff>1893</span> container_memory_rss
</span></span><span style=display:flex><span><span style=color:#ae81ff>1893</span> container_cpu_system_seconds_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1745</span> tcp_open_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1745</span> tcp_read_bytes_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1745</span> tcp_open_connections
</span></span><span style=display:flex><span><span style=color:#ae81ff>1745</span> tcp_write_bytes_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1700</span> container_cpu_usage_seconds_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1474</span> rest_client_request_latency_seconds_bucket
</span></span><span style=display:flex><span><span style=color:#ae81ff>1424</span> route_request_total
</span></span><span style=display:flex><span><span style=color:#ae81ff>1295</span> kube_pod_container_resource_requests
</span></span><span style=display:flex><span><span style=color:#ae81ff>1260</span> http_client_request_latency_seconds_bucket
</span></span></code></pre></div><ol start=2><li><strong>Via <code>/tsdb-status</code> endpoint:</strong></li></ol><p><img alt=tsdb-endpoint loading=lazy src=/tsdb-endpoint.png></p><p>Prometheus already provides outputs of the above <em>tsdb analyze</em> command in easy to understand manner at <code>prometheus-example.com/tsdb-status</code> endpoint.</p><ul><li>There are more details about the label pairs etc. on that endpoint, but for the scope of this article, we’ll focus on the top 10 series count by metric name.</li></ul><ol start=3><li><strong>Via PromQL query:</strong></li></ol><ul><li>If you’re more fond of PromQL to get things done, the above result can also be achieved by running the PromQL query :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>topk(10, count by (__name__)({__name__=~&#34;.+&#34;}))</span>
</span></span></code></pre></div><p><img alt=/promql-top10.png loading=lazy src=/promql-top10.png></p><ul><li>From the above pointers, now we know what are our costly metrics which we need to be aware of.</li></ul><p>Let’s assume we decided that we want to drop <code>prometheus_http_request_duration_seconds_bucket</code> & <code>prometheus_http_response_size_bytes_bucket</code> metric, as it&rsquo;s of no practical use to us.</p><h3 id=1-drop>1. Drop<a hidden class=anchor aria-hidden=true href=#1-drop>#</a></h3><p>In order to drop the above-mentioned metrics, we need to add <code>metric_relabel_configs</code> in Prometheus scrape config with the metric name we need to drop :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#34;prometheus&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#34;localhost:9090&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>metric_relabel_configs</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__name__]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;(prometheus_http_request_duration_seconds_bucket|prometheus_http_response_size_bytes_bucket)&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>action</span>: <span style=color:#ae81ff>drop</span>
</span></span></code></pre></div><p>complete flow will be like :</p><p><img alt=metric-drop-whimsical loading=lazy src=/metric-drop.png></p><ul><li><p><code>metric_relabel_configs</code> : metric relabeling process starts once the metrics is scraped. The reason for that is, the main label <code>__name__</code> will be generated post scraping.</p></li><li><p><code>source_labels</code>: we’re utilizing the label <code>__name__</code> to get the desired metric, since this itself is a label which has value of metric name. i.e <code>__name__=prometheus_http_request_duration_seconds_bucket</code></p></li></ul><blockquote><p>If you have lots of metrics which you need to <strong>drop</strong>, a better approach would be to use the action “keep” and mention the metric names you need to keep and everything else will be dropped.</p></blockquote><h3 id=2-keep>2. Keep<a hidden class=anchor aria-hidden=true href=#2-keep>#</a></h3><ul><li>As mentioned above, let’s try the permissive approach of Prometheus.</li><li>Here we will be only keeping metric <code>prometheus_http_requests_total</code> and drop everything else. The config looks like this :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scrape_configs:
</span></span><span style=display:flex><span>  - job_name: <span style=color:#e6db74>&#34;prometheus&#34;</span>
</span></span><span style=display:flex><span>    scrape_interval: 5s
</span></span><span style=display:flex><span>    static_configs:
</span></span><span style=display:flex><span>    - targets: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;localhost:9090&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    metric_relabel_configs:
</span></span><span style=display:flex><span>    - source_labels: <span style=color:#f92672>[</span>__name__<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      regex: prometheus_http_requests_total
</span></span><span style=display:flex><span>      action: keep
</span></span></code></pre></div><hr><h3 id=gotchas>Gotchas<a hidden class=anchor aria-hidden=true href=#gotchas>#</a></h3><ul><li>Once you have dropped the metric of choice, new samples won&rsquo;t get stored for that metric.</li><li>When a metric is not receiving any samples for ~5 min, it will be considered as a stale metric. You can read more about staleness <a href=https://prometheus.io/docs/prometheus/latest/querying/basics/#staleness>here</a>.</li><li>Depending on your retention period, the old time series will be removed once it reaches the retention, by default it&rsquo;s 15 days.</li><li>However, if you want to delete the stored metrics to clear up space, you can follow the below steps to achieve that.</li></ul><h2 id=deletion-of-single-metric>Deletion of single metric:<a hidden class=anchor aria-hidden=true href=#deletion-of-single-metric>#</a></h2><ol><li>In order to delete a series based on label, first you need to enable Admin API. You can enable the flag <code>-web.enable-admin-api</code> to do that. The complete command will look like this :</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./prometheus --web.enable-admin-api
</span></span></code></pre></div><ol start=2><li>Send a POST request with the label selectors of your choice to delete the resulting time series from starting date till today, i.e, everything for that time series.</li></ol><p>For example, the below will delete <code>prometheus_http_requests_total</code> from all scrape job (if there were multiple).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST -g <span style=color:#e6db74>&#39;http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=prometheus_http_requests_total&#39;</span>
</span></span></code></pre></div><p>In case you need to delete a metric from a specific scrape job, you can mention the job label.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-g <span style=color:#e6db74>&#39;http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=prometheus_http_requests_total{job=&#34;prometheus&#34;}&#39;</span>
</span></span></code></pre></div><ol start=3><li>The above step will mark the time series for deletion, but won&rsquo;t remove them from the disk at that moment. They will get flushed in future compaction.</li><li>If you need to remove them from the disk to clear the space instantly, you can hit the tombstone endpoint to purge the time series from the disk :</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -XPOST http://localhost:9090/api/v1/admin/tsdb/clean_tombstones
</span></span></code></pre></div><h2 id=deletion-of-multiple-metrics>Deletion of multiple metrics:<a hidden class=anchor aria-hidden=true href=#deletion-of-multiple-metrics>#</a></h2><ul><li>If you’re cleaning / optimizing your Prometheus TSDB, deleting a single metric won&rsquo;t do anything.</li><li>Hence, deletion of 100s if not 1000s of unnecessary time series is evident.</li><li>At of the time writing this article, you can&rsquo;t delete <em>n</em> metrics which are matched by regular expression.</li><li>I found a workaround for that via shell scripting for multiple metric deletion at a single shot.</li></ul><h3 id=example->Example :<a hidden class=anchor aria-hidden=true href=#example->#</a></h3><p>There are around 66 go based metrics which are available at Prometheus <code>/metrics</code> endpoint.</p><ul><li>If you want to delete all of them, then you can perform the below steps, since regex based deletion is not possible as of now.</li><li>The below command will grab all the metrics which starts with <code>go_</code> .</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># get all metric name with go_* into a txt file.</span>
</span></span><span style=display:flex><span>curl http://localhost:9090/api/v1/label/__name__/values | tr <span style=color:#e6db74>&#39;,&#39;</span> <span style=color:#e6db74>&#39;\n&#39;</span> | tr -d <span style=color:#e6db74>&#39;&#34;&#39;</span> | grep <span style=color:#e6db74>&#39;^go_.*&#39;</span> &gt; prom_go_metrics.txt
</span></span></code></pre></div><ul><li>The metrics collected in file will look like :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat prom_go_metrics.txt | head -n <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go_gc_cycles_forced_gc_cycles_total
</span></span><span style=display:flex><span>go_gc_cycles_total_gc_cycles_total
</span></span><span style=display:flex><span>go_gc_duration_seconds
</span></span><span style=display:flex><span>go_gc_duration_seconds_count
</span></span><span style=display:flex><span>go_gc_duration_seconds_sum
</span></span></code></pre></div><ul><li>Create a bash script delete-metrics.sh, append the below contents and run it :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#shell script to go over each metric in the file and request the API for deletion recursively.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#e6db74>`</span>cat prom_go_metrics.txt<span style=color:#e6db74>`</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        curl -X POST -g <span style=color:#e6db74>&#39;http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=&#39;</span>$i<span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><ul><li>If the deletion is successful, the response will be empty.</li><li>Once the deletion is successful, use Promtool to query metrics via CLI or check via web UI to see if the metric returns any value. The response should be empty.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>promtool query series http://localhost:9090 --match=go_gc_heap_allocs_by_size_bytes_total</span>
</span></span></code></pre></div><hr><p>References :</p><ul><li><a href=https://prometheus.io/docs/prometheus/latest/querying/api/#delete-series>https://prometheus.io/docs/prometheus/latest/querying/api/#delete-series</a></li><li><a href=https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs>https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs</a></li><li><a href=https://relabeler.promlabs.com/>https://relabeler.promlabs.com/</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://tanmay-bhat.github.io/tags/prometheus/>Prometheus</a></li></ul><nav class=paginav><a class=prev href=https://tanmay-bhat.github.io/posts/how-to-prevent-metrics-explosion-in-prometheus/><span class=title>« Prev</span><br><span>How to prevent metrics explosion in Prometheus</span>
</a><a class=next href=https://tanmay-bhat.github.io/posts/how-to-calculate-the-storage-space-required-for-prometheus-server/><span class=title>Next »</span><br><span>How to calculate the storage space required for Prometheus server</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on x" href="https://x.com/intent/tweet/?text=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus&amp;url=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f&amp;hashtags=Prometheus"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f&amp;title=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus&amp;summary=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus&amp;source=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f&title=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus%20-%20https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on telegram" href="https://telegram.me/share/url?text=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus&amp;url=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to drop and delete metrics in Prometheus on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20to%20drop%20and%20delete%20metrics%20in%20Prometheus&u=https%3a%2f%2ftanmay-bhat.github.io%2fposts%2fhow-to-drop-and-delete-metrics-in-prometheus%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tanmay-bhat.github.io/>Tanmay Bhat</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>